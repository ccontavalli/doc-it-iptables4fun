<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.69">
 <TITLE>IPtables for Fun -- Implementare un firewall in linux: Hardening the system : Ridurre i punti di ingresso</TITLE>
 <LINK HREF="iptables4fun-14.html" REL=next>
 <LINK HREF="iptables4fun-12.html" REL=previous>
 <LINK HREF="iptables4fun.html#toc5" REL=contents>
</HEAD>
<BODY>
<A HREF="iptables4fun-14.html">Avanti</A>
<A HREF="iptables4fun-12.html">Indietro</A>
<A HREF="iptables4fun.html#toc5">Indice</A>
<HR>
<H2>5.1 <A HREF="iptables4fun.html#toc5.1">Ridurre i punti di ingresso</A></H2>

<P>L'idea di base &egrave; quella di eliminare tutto ci&ograve; che in rete
potrebbe essere facilmente attaccato. Potreste quindi voler seguire
le indicazioni contenute nelle prossime sezioni.</P>

<H3>inetd.conf</H3>

<P>In questo file sono indicati alcuni servizi di rete che dovranno essere attivi
sulla vostra macchina. Alcune distribuzioni, invece dello standard inetd, utilizzano
xinetd che fa uso di una struttura a directory e di un diverso file di configurazione.
Se la vostra distribuzione utilizza inetd.conf, vi dovrebbe bastare commentare tutte le
righe che servono per attivare servizi che non vi interessa offrire, inserendo un 
``#'' all'inizio della riga stessa. Un
tipico file inetd.conf al termine dell'installazione di debian (a secondo di quello
che &Egrave; stato installato) potrebbe essere simile al seguente:
<BLOCKQUOTE><CODE>
<PRE>
# [...]
#
#:INTERNAL: Internal services
echo            stream  tcp     nowait  root    internal
echo            dgram   udp     wait    root    internal
chargen         stream  tcp     nowait  root    internal
chargen         dgram   udp     wait    root    internal
discard         stream  tcp     nowait  root    internal
discard         dgram   udp     wait    root    internal
daytime         stream  tcp     nowait  root    internal
daytime         dgram   udp     wait    root    internal
time            stream  tcp     nowait  root    internal
time            dgram   udp     wait    root    internal

#:STANDARD: These are standard services.
ftp             stream tcp nowait root /usr/sbin/tcpd /usr/sbin/proftpd

#:BOOT: Tftp service is provided primarily for booting.  Most sites
# run this only on machines acting as "boot servers."
#tftp           dgram   udp     wait    nobody  /usr/sbin/tcpd  /usr/sbin/in.tftpd /boot

# [...]
</PRE>
</CODE></BLOCKQUOTE>

La maggior parte di questi servizi (il nome indicato nella prima colonna), 
sono servizi *nix standard, forniti per motivi di conformit&agrave; con altri
sistemi *nix e per lo pi&ugrave; inutili.</P>
<P>Nel nostro caso, il firewall non offrir&agrave; alcun servizio, nel senso
che non vi sar&agrave; installato alcun server, salvo, forse, per il server
``ssh'' per l'amministrazione remota. Dovremmo quindi provvedere a commentare
tutte le righe inserendo un cancelletto all'inizio della riga, come mostrato
per il servizio ``tftp''.</P>
<P>Nel caso decidiate di lasciare alcuni servizi aperti, fate attenzione alla
quinta colonna, che contiene i privilegi con cui il programma verr&agrave;
eseguito, e alla sesta, che contiene il programma da eseguire. A parte 
i programmi indicati come internal, la maggior parte delle volte vedrete
in sesta colonna il comando ``/usr/sbin/tcpd''. Questo, in gergo,
viene definito un ``wrapper''. Quello che fa questo comando, infatti,
&egrave; semplicemente eseguire ci&ograve; che viene indicato nella
colonna successiva. L'utilit&agrave; del wrapper &egrave; che prima di 
eseguire il comando indicato, quando ricever&agrave; una connessione, questo 
si occuper&agrave; di effettuare alcune verifiche
decidendo se bloccare o consentire l'utilizzo del servizio.</P>
<P>Le decisioni di questo wrapper sono normalmente basate sul contenuto
del file /etc/hosts.allow e /etc/hosts.deny.
Maggiori informazioni sul formato di questo file possono essere
reperite sulla pagina di manuale di ``hosts_access'' e ``hosts_options''.</P>

<H3>Directory /etc/init.d</H3>

<P>In questa directory sono normalmente contenute due categorie di script:
<UL>
<LI>quelli necessari per effettuare alcune operazioni durante l'accensione
e lo spegnimento del computer.</LI>
<LI>quelli necessari per far partire o bloccare quei servizi che una volta
attivati dovrebbero continuare a funzionare finch&egrave; non esplicitamente
bloccati (facendo il logout non si fermano -- demoni come apache, bind,
sendmail o ...).</LI>
</UL>

In Debian e in altre distribuzioni con un sistema di boot conforme a quello di System V,
in /etc (o /etc/rc.d) esistono altre directory chiamate rc0.d,
rc1.d, rc2.d e cos&igrave; via. Queste directory contengono dei link
simbolici agli script in ``init.d'' che dovranno essere eseguiti quando si passa rispettivamente
a runlevel 0, 1, 2 e cos&igrave; via.</P>
<P> Ogni runlevel, poi, pu&ograve; essere utilizzato in 
modo diverso e gli pu&ograve; venire assegnato un particolare significato. Ad esempio, l'operazione
di shutdown consiste nel passaggio dal runlevel corrente al runlevel 0 (per cui, tutti gli script
in rc0.d verranno utilizzati per bloccare i vari servizi e per eseguire le operazioni
di spegnimento), il runlevel 2 &egrave; quello standard
che viene eseguito quando si accende il computer, ed il 6 viene usato per il reboot.</P>
<P>Per rendere pi&ugrave; sicuro il nostro firewall, dovremmo quindi prodigarci per evitare che
durante l'accensione vengano avviati dei servizi che potrebbero essere utilizzati contro di noi.</P>
<P>Il metodo normalmente utilizzato &egrave; quello di eliminare i link simbolici (con un semplice rm)
relativi a servizi che non ci interessano dalla directory relativa al runlevel utilizzato per avviare 
il sistema (normalmente ``rc2.d'', almeno in Debian).
Alcune distribuzioni utilizzano metodi pi&ugrave; esotici per gestire questi link simbolici, per cui
vi conviene dare un'occhiata alla documentazione che vi &egrave; stata fornita.</P>
<P>In Debian per esempio, &egrave; possibile utilizzare lo script ``update-rc.d'', con 
qualcosa di simile a:
<BLOCKQUOTE><CODE>
<PRE>
  update-rc.d apache remove
</PRE>
</CODE></BLOCKQUOTE>

per evitare che apache venga caricato durante l'avvio o lo shutdown. Un'altra alternativa
potrebbe essere quella di rimuovere del tutto apache (probabilmente inutile se non lo si 
fa partire a boot-up), con il solito:
<BLOCKQUOTE><CODE>
<PRE>
  apt-get --purge remove apache
</PRE>
</CODE></BLOCKQUOTE>

Per avere un elenco dei programmi attivi che offrono servizi in rete, potreste
voler utilizzare il comando netstat, con 
<BLOCKQUOTE><CODE>
<PRE>
  # netstat -npla |less
</PRE>
</CODE></BLOCKQUOTE>

che vi dovrebbe indicare le porte rimaste aperte ed i relativi processi.</P>



<H3>Demoni</H3>

<P>In generale comunque, per i servizi che deciderete di lasciare attivi, ricordatevi
dove possibile di:
<UL>
<LI>eliminare banner di benvenuto o comunque quelle informazioni che 
mostrino il nome e la versione dei programmi utilizzati.</LI>
<LI>controllate mailing list di sicurezza, come per esempio bugtraq, 
per verificare che i demoni lasciati attivi non contengano bug
pericolosi.</LI>
<LI>non lasciate demoni attivi con privilegi di root.</LI>
</UL>

Per ci&ograve; che offre servizi in rete, se vi voleste veramente divertire,
potreste utilizzare delle porte diverse rispetto quelle standard: se metteste per esempio 
ssh sulla porta 42 piuttosto che sulla 54, potreste evitare tutti quegli scanner che 
mandano pacchettini in giro per la rete alla ricerca di particolari versioni di particolari 
software da poter facilmente bucare. Certo, questo pu&oacute; creare parecchia confusione 
anche dal punto di vista dell'amministrazione (soprattutto se ogni volta utilizzate una porta 
diversa), ma a lungo andare potrebbe dimostrarsi una utile contromisura. Attenzione
per&ograve; che se il demone che state utilizzando contiene dei bachi di sicurezza, questo
continuer&agrave; ad averne anche se deciderete di utilizzare una diversa porta.</P>
<P>Per cambiare impostazioni come la porta, i privilegi che il demone dovr&agrave;
avere o per cambiare i banner di benvenuto, riferitevi alla documentazione specifica
fornita col demone installato.</P>

<HR>
<A HREF="iptables4fun-14.html">Avanti</A>
<A HREF="iptables4fun-12.html">Indietro</A>
<A HREF="iptables4fun.html#toc5">Indice</A>
</BODY>
</HTML>
