<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.69">
 <TITLE>IPtables for Fun -- Implementare un firewall in linux: Preparare il proprio sistema: Preparare il kernel</TITLE>
 <LINK HREF="iptables4fun-10.html" REL=next>
 <LINK HREF="iptables4fun-8.html" REL=previous>
 <LINK HREF="iptables4fun.html#toc4" REL=contents>
</HEAD>
<BODY>
<A HREF="iptables4fun-10.html">Avanti</A>
<A HREF="iptables4fun-8.html">Indietro</A>
<A HREF="iptables4fun.html#toc4">Indice</A>
<HR>
<H2>4.3 <A HREF="iptables4fun.html#toc4.3">Preparare il kernel</A></H2>

<P>Esistono centinaia di howto (se non migliaia) in giro per internet su come ricompilare
il kernel e per questo mi limiter&ograve; a dare le istruzioni fondamentali per avere un buon 
kernel adatto per un firewall.</P>
<P>Ricordatevi per&ograve; sempre di configurare il kernel <B>dopo</B> :-) aver applicato tutte
le patch, onde evitare di faticare ad applicare delle patch che non verranno mai utilizzate per 
via dei parametri scelti con ``menuconfig'' (o ``xconfig'' o ...).</P>


<H3>Configurarlo</H3>

<P>Ok, a questo punto dovreste avere il vostro kernel decompresso in giro da qualche
parte su una delle vostre partizioni. Entrate dunque nella directory dove &egrave; stato decompresso
e preparatevi per compilarlo con il solito:
<BLOCKQUOTE><CODE>
<PRE>
        # make menuconfig
</PRE>
</CODE></BLOCKQUOTE>

Se vi si presenta un errore qui, la maggior parte delle volte &egrave; perch&eacute;
vi mancano gli header delle ncurses o dei tool fondamentali. Rileggete la sezione
sul <I>prepararsi a ricompilare</I> e su come <I>procurarsi i sorgenti</I>.
Abilitate quindi tutto ci&ograve; che vi serve, con particolare attenzione per&ograve; al men&ugrave;
delle ``networking options''. Abilitate dunque, tenendo le feature sperimentali 
disabilitate:
<BLOCKQUOTE><CODE>
<PRE>
Packet socket
  Packet socket: mmapped IO
Netlink device emulation
Network Packet filtering
Socket Filtering
Unix Domain Sockets
TCP/IP networking
  IP: multicasting
  IP: advanced router 
       e tutte le voci che appariranno
  IP: Tunnelling
  IP: GRE tunnels over IP
    IP: Broadcast GRE over IP
  IP: multicast routing
       e tutte le voci che appariranno
  
  IP: TCP syncookie support 
       (solo se avete un kernel relativamente recente, non ricordo 
       la versione corretta, ma ogni &gt; 2.4.10 dovrebbe andare)
  IP: Netifilter configuration
    Connection Tracking 
       e tutte le voci che appariranno
    IP Tables support
       e tutte le voci che appariranno
802.1d Ethernet Bridging
E tutte le voci sotto 'QoS' and fair queuing
</PRE>
</CODE></BLOCKQUOTE>

Attenzione che la maggior parte di queste opzioni non sono indispensabili (anzi, probabilmente
non le userete mai). Quando per&ograve; mi capita di ricompilare un kernel per un firewall, mi piace 
pensare che abbia tutto ci&ograve; che al momento &egrave; disponibile, e spesso torno indietro abilitando
anche le feature sperimentali, in modo da poter selezionare:
<UL>
<LI>Tutte quelle feature aggiunte tramite patch</LI>
<LI>Il supporto per le VLAN</LI>
<LI>Molti altri componenti gi&agrave; forniti col kernel, parte di iptables, ma considerati
sperimentali.</LI>
</UL>

Attenzione che il vostro kernel non influenzer&agrave; soltanto il comportamento del firewall in 
rete, ma sar&agrave; un componente indispensabile per la sicurezza e la stabilit&agrave; del vostro sistema.
Assicuratevi quindi di comprendere pienamente tutto ci&ograve; che selezionate (comprese le cose
che vi ho indicato), e fatte le dovute considerazioni, non sentitevi in colpa a fare diversamente
da quanto suggerito. Nella peggiore delle ipotesi, dovrete ricompilare il kernel...</P>
<P>Ci sono quindi diverse cose che potreste considerare configurando il kernel del vostro firewall:
<UL>
<LI>Aggiungere delle patch per ``rinforzare'' il sistema (la openwall, www.openwall.com 
non appena sar&agrave; disponibile, oppure la LIDS, che per&ograve; &egrave; molto
invasiva).</LI>
<LI>Disabilitare il supporto per i moduli (esiste almeno un rootkit basato su moduli del kernel, ed
un kernel senza supporto per i moduli potrebbe complicare non di poco il lavoro di un possibile intruso).</LI>
<LI>Abilitare file system come il reiser, l'ext3 o il devfs (per essere in grado di montare i dischi read-only
e per avere una macchina che si comporti un po' come un videoregistratore: che si possa cio&egrave; 
tranquillamente spegnere e accendere senza avere alcuna competenza di linux, o che comunque
in caso di mancanza di corrente non abbia alcun problema a ripartire velocemente).</LI>
<LI>Abilitare il frame buffer, per riuscire a scrivere facilemente regole pi&uacute; lunghe.</LI>
</UL>

Questi sono soltanto spunti o suggerimenti, sta al vostro estro produrre un kernel il pi&ugrave; utile e 
funzionale possibile.</P>
<P>Ricordatevi poi che in un firewall non esiste solo il networking, e non dimenticatevi quindi di
scegliere opportunamente il processore, le periferiche e... </P>
<P>Infine, dopo aver ricompilato ed incluso tutte le funzioni che pi&ugrave; vi stanno a cuore, 
ricordatevi di verificare di aver ottenuto qualcosa di stabile ed utilizzabile, provando il
vostro firewall prima di metterlo in produzione.</P>

<H3>Ricompilarlo</H3>

<P>Per molti di voi sar&agrave; probabilmente superfluo dire di dare:
<BLOCKQUOTE><CODE>
<PRE>
        # make dep bzImage modules modules_install
</PRE>
</CODE></BLOCKQUOTE>

Seguite poi la procedura della vostra distribuzione (o prevista dal vostro boot loader) per installare
il nuovo kernel (lilo piuttosto che grub).</P>
<P>Se ci dovessero essere errori, l'unica cosa che posso suggerirvi &egrave; di provare a correggere gli errori
o eventualmente disabilitare una patch per volta (via menuconfig) fino a riottenere qualcosa di 
ricompilabile...</P>

<H3>In Debian</H3>

<P>Date:
<BLOCKQUOTE><CODE>
<PRE>
        # apt-get install kernel-package
        # make-kpkg binary modules
        # cd ..; dpkg -i kernel-image-2.4.x....deb; dpkg -i kernel-headers*.deb
</PRE>
</CODE></BLOCKQUOTE>
</P>

<HR>
<A HREF="iptables4fun-10.html">Avanti</A>
<A HREF="iptables4fun-8.html">Indietro</A>
<A HREF="iptables4fun.html#toc4">Indice</A>
</BODY>
</HTML>
